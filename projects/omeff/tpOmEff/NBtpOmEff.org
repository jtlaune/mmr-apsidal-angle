#+TITLE: Test particle omeff calculations
#+BEGIN_SRC jupyter-python :session /jpy:localhost#8888:research
  import numpy as np
  import importlib
  import os
  from numpy import sqrt, cos, sin, pi, abs
  import scipy as sp
  import matplotlib as mpl
  import matplotlib.pyplot as plt
  import sys
  sys.path.append("/home/jtlaune/multi-planet-architecture/")
  from mpa.mpl_styles import analytic
  from mpa.series import FOomEffSeries

  deg_conv = 180./np.pi

  def load_params(filepath):
      spec = importlib.util.spec_from_file_location("_", filepath)
      _ = importlib.util.module_from_spec(spec)
      spec.loader.exec_module(_)
      print(f"Loading run file {filepath} in directory {os.getcwd()}")
      return(np.array(_.RUN_PARAMS))
#+END_SRC

#+RESULTS:

* analysis of constant omext1
** external 1e-4<omeff<1e-2
*** final eccentricities
#+BEGIN_SRC jupyter-python :session /jpy:localhost#8888:research
  @mpl.rc_context(analytic)
  def plot():
      projpath = "/home/jtlaune/multi-planet-architecture/projects/omeff/"
      seriesname = "lastrun"
      seriesdir = os.path.join(projpath, seriesname)
      paramsname = seriesname+"-params.py"
      runpath = seriesdir
      series = FOomEffSeries(seriesname, runpath, load=True, verbose=True, overwrite=False)
      params = series.RUN_PARAMS
      fig, ax = plt.subplots()

      for i in [7, 8, 9, 10, 11, 12]:
          prescomEff = float(params[i,-2]) # prescribed omext1
          sim = series.data[i]
          teval = sim["teval"]
          ti = int(len(teval)*0.9)
          diffom = np.abs(sim["g2"][ti:] - sim["g1"][ti:]) # actual
          avgDom = np.average(diffom) # average
          e1 = sim["e1"][ti:]
          e2 = sim["e2"][ti:]
          e1avg = np.average(e1)
          e2avg = np.average(e2)
          ax.scatter(prescomEff, e1avg, c="k", s=10)
          ax.scatter(prescomEff, e2avg, c="r", s=10)
          #ax.scatter(prescomEff, avgDom, c="r", s=20)
          print(prescomEff)
          # ax.scatter(teval, diffom, c="k", s=10)

      ax.legend()
      figfp = os.path.join(seriesdir, "final-ecc-states.png")
      fig.savefig(figfp, bbox_inches="tight")
      ax.set_xscale("log")
      ax.set_title(r"Final $e_1$, $e_2$ values for varying $\dot\varpi_{1,\rm ext}$",
                   pad=20)
      ax.set_xlabel(r"$\dot\varpi_{1,\rm ext}$")
      ax.set_ylabel(r"final eccentricity")
  plot()
#+END_SRC

#+RESULTS:
:RESULTS:
#+begin_example
  No handles with labels found to put in legend.
  [ 0.00000000e+00 -1.00000000e-09 -1.58489319e-08 -2.51188643e-07
   -3.98107171e-06 -6.30957344e-05 -1.00000000e-03  1.00000000e-09
    1.58489319e-08  2.51188643e-07  3.98107171e-06  6.30957344e-05
    1.00000000e-03  0.00000000e+00  0.00000000e+00  0.00000000e+00
    0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00
    0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00
    0.00000000e+00] [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00
    0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00
    0.00000000e+00  0.00000000e+00  0.00000000e+00  0.00000000e+00
    0.00000000e+00 -1.00000000e-09 -1.58489319e-08 -2.51188643e-07
   -3.98107171e-06 -6.30957344e-05 -1.00000000e-03  1.00000000e-09
    1.58489319e-08  2.51188643e-07  3.98107171e-06  6.30957344e-05
    1.00000000e-03]
  1e-09
  1.5848931924611143e-08
  2.5118864315095823e-07
  3.981071705534969e-06
  6.309573444801929e-05
  0.001
#+end_example
[[file:./.ob-jupyter/1a10f671bc7c0fabfa6500eb3bbdb7994fcd2a00.png]]
:END:
