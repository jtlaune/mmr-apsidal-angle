#+TITLE: Test particle omeff calculations
#+BEGIN_SRC jupyter-python :session /jpy:localhost#8888:research
  import numpy as np
  import importlib
  import os
  from numpy import sqrt, cos, sin, pi, abs
  import scipy as sp
  import matplotlib as mpl
  import matplotlib.pyplot as plt
  import sys
  sys.path.append("/home/jtlaune/multi-planet-architecture/")
  from mpa.mpl_styles import analytic
  from mpa.series import FOomEffTPSeries

  deg_conv = 180./np.pi

  def load_params(filepath):
      spec = importlib.util.spec_from_file_location("_", filepath)
      _ = importlib.util.module_from_spec(spec)
      spec.loader.exec_module(_)
      print(f"Loading run file {filepath} in directory {os.getcwd()}")
      return(np.array(_.RUN_PARAMS))
#+END_SRC

#+RESULTS:

* external 1e-4<omeff<1e-2
*** final eccentricities
#+BEGIN_SRC jupyter-python :session /jpy:localhost#8888:research
  @mpl.rc_context(analytic)
  def plot():
      projpath = "/home/jtlaune/multi-planet-architecture/projects/omeff/"
      seriesname = "tpOmEff"
      seriesdir = os.path.join(projpath, seriesname)
      paramsname = seriesname + "-params.py"
      runpath = seriesdir
      series = FOomEffTPSeries(
          seriesname, runpath, load=True, verbose=True, overwrite=False, loadall=False
      )
      params = series.RUN_PARAMS
      fig, ax = plt.subplots()

      for i in range(32, 47):
          prescomEff = float(params[i, -1])  # prescribed omext1
          sim = series.data[i]
          teval = sim["teval"]
          ti = int(len(teval) * 0.9)
          diffom = np.abs(sim["g2"][ti:] - sim["g1"][ti:])  # actual
          avgDom = np.average(diffom)  # average
          e1 = sim["e1"][ti:]
          e2 = sim["e2"][ti:]
          e1avg = np.average(e1)
          e2avg = np.average(e2)
          print(prescomEff)
          ax.scatter(prescomEff, e1avg, c="k", s=10)
          ax.scatter(prescomEff, e2avg, c="r", s=10)
          # ax.scatter(prescomEff, avgDom, c="r", s=20)
          # ax.scatter(teval, diffom, c="k", s=10)

      ax.legend()
      figfp = os.path.join(seriesdir, "final-ecc-states.png")
      fig.savefig(figfp, bbox_inches="tight")
      ax.set_title(
          r"Final $e_1$, $e_2$ values for varying $\dot\varpi_{\rm eff}$", pad=20
      )
      ax.set_xlabel(r"$\dot\varpi_{1,\rm ext}$")
      ax.set_ylabel(r"final eccentricity")


  plot()
#+END_SRC

#+RESULTS:
:RESULTS:
#+begin_example
  Cannot find file 0048-mup1.00e-04-omeff0.00e+00.npz... have you run it?
  Cannot find file 0049-mup1.00e-04-omeff0.00e+00.npz... have you run it?
  Cannot find file 0050-mup1.00e-04-omeff0.00e+00.npz... have you run it?
  Cannot find file 0051-mup1.00e-04-omeff0.00e+00.npz... have you run it?
  Cannot find file 0052-mup1.00e-04-omeff0.00e+00.npz... have you run it?
  Cannot find file 0053-mup1.00e-04-omeff0.00e+00.npz... have you run it?
  -0.0001
  -0.00013593563908785255
  -0.00018478497974222906
  -0.00025118864315095795
  -0.0003414548873833601
  -0.00046415888336127773
  -0.000630957344480193
  -0.0008576958985908946
  -0.0011659144011798312
  -0.001584893192461114
  -0.002154434690031882
  -0.0029286445646252374
  -0.003981071705534973
  No handles with labels found to put in legend.
  -0.0054116952654646375
  -0.007356422544596414
#+end_example
#+attr_org: :width 473
[[file:./.ob-jupyter/92f09598329ac4c82a7c47b94e7f4d20c9e6e584.png]]
:END:
