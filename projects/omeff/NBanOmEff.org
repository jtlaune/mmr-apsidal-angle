#+TITLE: Coplanar MMR Notes
#+AUTHOR: JT Laune
#+DATE: <2022-02-08 Tue>
#+LATEX_CLASS: article
#+OPTIONS: toc:nil
#+LATEX_HEADER: \usepackage{amsthm}
#+LATEX_HEADER: \usepackage[margin=1.5in]{geometry}
#+LATEX_HEADER: \newtheorem{defn}{Definition}
#+STARTUP: nolatexpreview

* Problem
Consider $n$ point *orbiters* with finite masses
$m_1,m_2,m_3,\ldots\ll M$, where $M$ is the mass of the primary about
which they orbit. In the absence of dissipation, its Hamiltonian is:
#+begin_src latex
  \begin{align}
    \mathcal H
    &\simeq \sum^{n}_{i=1}\left(\frac12 \frac{\vec p_i\cdot\vec p_i}{m_i}
      -\frac{GMm_i}{2|\vec x_i|}
      -\sum_{j\neq i}^{n} \frac{Gm_im_j}{2|\vec x_i - \vec x_j|}
      \right),
  \end{align}
#+end_src
\noindent where $\vec x_i$ and $\vec p_i$ are the Cartesian position
and momentum vectors, respectively.  For now, we'll be considering the
case of 2 orbiters $m_1$ and $m_2$ around a primary of mass $M$.

We now transform to orbital elements and add the following potential
to the Hamiltonian:
#+begin_src latex
  \begin{align}
    \mathcal H_{\rm ext}
    &= -\dot\varpi_{1,\rm ext}\Gamma_1 - \dot\varpi_{1,\rm ext}\Gamma_2,
  \end{align}
#+end_src
\noindent where the $\Gamma_i=\frac12m_i\sqrt{a_i}(1-\sqrt{1-e_i^2})$
are the canonically conjugate momenta for the canonical coordinate
$-\varpi_i$.  This induces constant differential rotation in the
Runge-Lenz vectors, $\vec{e}_1$ and $\vec{e}_2$.  We treat
$\dot\varpi_{i,\rm ext}$ as free, constant parameters.

*How does differential apsidal precession affect the dynamics of first order MMRs?*

** Parameters
We define:
#+begin_src latex
  \begin{align}
   q&\equiv \frac{m_1}{m_2}\quad\text{mass ratio with each other}\\ 
   \mu_i&\equiv \frac{m_i}{M}\quad\text{dimless mass}\\ 
   \mu_{\rm tot}&\equiv \mu_1+\mu_2\quad\text{total mass},\\ 
   %\mu_{\rm ext}&\equiv \frac{m_{\rm ext}}{M}\quad\text{total mass},\\ 
   \dot\varpi_{i, \rm ext} &\equiv \text{externally induced precession of $\varpi_i$} \\
   \dot\varpi_{\rm eff} &\equiv \dot\varpi_{1,\rm ext}-\dot\varpi_{2,\rm ext} \quad\text{differential precession} \\
  \end{align}
#+end_src
@@latex:\noindent@@
where $M$ is the primary mass.

** Assumptions and notation
- Coplanar
- Orbiter masses are small $\mu_i\ll 1$
- Two situations:
  - Two comparable mass orbiters, internal/external denoted by
    $i=1,2$, mass ratio $q\equiv m_1/m_2$.
  - Test particle limit, $q\to0,\infty$. Denote test particle with no
    subscript and perturbing mass with $p$ subscript. Test particle
    can be inside or outside the perturber.
- Near a first order MMR (1MMR), defined by $P_2/P_1\simeq (j+1)/j$,
  with $j = 1, 2, \ldots$
  - Eccentricities are small, $e_i\ll 1$
    - First order expansion of perturbing potential in $e_i$
- independently parameterized $\dot\varpi_{1,\rm ext}$ and
  $\dot\varpi_{2,\rm ext}$ induced by an arbitrary potential

* MMR Hamiltonian Model
Index MMR locations with $j$, such that first order MMRs (hereafter ``1MMRS'') occur whenever
$n_1/n_2\simeq(j+1)/j$.
Near these points, the following angles in the literal expansion of the perturbing
function (see [[cite:&murray_solar_2000][Murray and Dermott]] for details) have commensurate ``fast'' frequencies
#+begin_src latex
  \begin{align}
  \theta_1 &= (j+1)\lambda_2-j\lambda_1-\varpi_1\\
  \theta_2 &= (j+1)\lambda_2-j\lambda_1-\varpi_2,
  \end{align}
#+end_src
@@latex:\noindent@@
because the terms $(j+1)\lambda_2-j\lambda_1\approx 0$ near the MMR locations (by definition).

We choose dimensionless time units so that $GM=1$ and
the Hamiltonian is given by
#+begin_src latex
  \begin{equation}
    \mathcal{H} = -\frac{m_1}{2a_1} -\frac{m_2}{2a_2} - \mu_2 m_1 f_1(\alpha) e_1 \cos\theta_1 + \mu_1 m_2 f_2(\alpha) e_2\cos\theta_2
  \end{equation}
#+end_src
@@latex:\noindent@@
where the mass ratios $\mu_1$ and $\mu_2$ now play the part as the perturbation parameter.

In the restricted planar 3-body problem, one planet is a test particle and has mass equal to zero.
For an internal (external) test particle,
the appropriate limit for the Hamiltonian above is $m_1\to0$ ($m_2\to0$).
The Hamiltonian for an inner test particle is therefore
#+begin_src latex
  \begin{equation}
    \mathcal{H} = -\frac{1}{2a_1} - \mu_p( f_1(\alpha) e_1 \cos\theta_1 + f_2(\alpha) e_p\cos\theta_p)
  \end{equation}
#+end_src
@@latex:\noindent@@

* Test particle results for $\dot\varpi_{\rm eff}>0$
From the definitions of the angles $\theta_1$ and $\theta_2$,
any external precession frequency will "split" the location
of $\theta_1$ and $\theta_2$. The effects of this
shift are summarized in the diagram.

#+attr_latex: :float :width 1\textwidth
#+caption: Nominal MMR locations vs how they shift due to external precession.
[[~/multi-planet-architecture/projects/omeff/images/resShiftDiag.png]]

** Internal $\dot\varpi_{\rm eff}\in[10^{-8},10^{-1}]$
Set $\mu_p=1e-4$, $a_0=1$, and let the test particle migrate
outwards. The perturber is on a stationary orbit, unlike Maryam's
paper. Differential rotation couples to the perturber eccentricity to
possibly disrupt capture.  The capture process leads to several
different combinations of librating resonant angles, summarized in
Tables ref:tab:int-pos and ref:tab:int-neg.  The simulations extended
down to $\dot\varpi_{\rm eff}10^{-8}$, but the results were not
interesting.  We set $\dot\varpi_{\rm eff} = \dot\varpi_{1,\rm ext}$
and set $\dot\varpi_{2, \rm ext}=0$. The idea here is
that we can always transfer to the constantly-rotating
frame of $\mu_p$.


#+attr_latex: :mode table :environment tabular :align | l | c | c | c | c |
#+name: tab:int-pos
#+caption: Librating angles for an internal test particle with $\varpi_{\rm eff}>0$.
#+caption: First two rows demonstrate weak coupling to $e_p$ parameter.
#+caption: Last two rows demonstrate bifurcation in resonance behavior due to
#+caption: $e_p-\om_{\rm eff}$ coupling.  Blank spots are just our migration
#+caption: model failing for the internal case (not a problem).  None means the
#+caption: resonant capture was disrupted and none of the three resonance angles,
#+caption: $\theta_1$, $\theta_2$, and $\hat\theta$, are librating.
|------------------+----------------------------------+----------------------------------+------------------------+------------------------|
| \dot\varpi_{\rm eff} | 10^{-1}                          | 10^{-2}                          | 10^{-3}                | 10^{-4}                |
|------------------+----------------------------------+----------------------------------+------------------------+------------------------|
| e_p=0            | \theta_1, $\hat\theta$           | \theta_1, $\hat\theta$           | \theta_1, $\hat\theta$ | \theta_1, $\hat\theta$ |
|------------------+----------------------------------+----------------------------------+------------------------+------------------------|
| e_p=0.001        | \theta_1, $\hat\theta$           | \theta_1, $\hat\theta$           | \theta_1, $\hat\theta$ | \theta_1, $\hat\theta$ |
|------------------+----------------------------------+----------------------------------+------------------------+------------------------|
| e_p=0.03         | \theta_1                         | \theta_1, \theta_2, $\hat\theta$ | None                   | None                   |
|------------------+----------------------------------+----------------------------------+------------------------+------------------------|
| e_p=0.1          | \theta_1, \theta_2, $\hat\theta$ | \theta_1, \theta_2, $\hat\theta$ | None                   |                        |
|------------------+----------------------------------+----------------------------------+------------------------+------------------------|

#+attr_latex: :mode table :environment tabular :align | l | c | c | c | c |
#+name: tab:int-neg
#+caption: Same as Table \ref{tab:int-pos} but with $\varpi_{\rm omeff}<0$.
|----------------------+------------------------+------------------------+------------------------+------------------------|
| \dot\varpi_{\rm eff} | -10^{-1}               | -10^{-2}               | -10^{-3}               | -10^{-4}               |
|----------------------+------------------------+------------------------+------------------------+------------------------|
| e_p=0                | \theta_1, $\hat\theta$ | \theta_1, $\hat\theta$ | \theta_1, $\hat\theta$ | \theta_1, $\hat\theta$ |
|----------------------+------------------------+------------------------+------------------------+------------------------|
| e_p=0.001            | \theta_1, $\hat\theta$ | \theta_1, $\hat\theta$ | \theta_1, $\hat\theta$ | \theta_1, $\hat\theta$ |
|----------------------+------------------------+------------------------+------------------------+------------------------|
| e_p=0.03             | \theta_1               | \theta_1               | None                   |                        |
|----------------------+------------------------+------------------------+------------------------+------------------------|
| e_p=0.1              | \theta_1               | \theta_1               | None                   |                        |
|----------------------+------------------------+------------------------+------------------------+------------------------|

** External $\dot\varpi_{\rm eff}\in[10^{-4},10^{-2}]$
|----------------------+---+---+---+---|
| \dot\varpi_{\rm eff} |   |   |   |   |
|----------------------+---+---+---+---|
| e_p=0                |   |   |   |   |
|----------------------+---+---+---+---|
| e_p=0.001            |   |   |   |   |
|----------------------+---+---+---+---|
| e_p=0.03             |   |   |   |   |
|----------------------+---+---+---+---|
| e_p=0.1              |   |   |   |   |
|----------------------+---+---+---+---|
* Test particle results for capture timescales

** Internal

* References
bibliography:references.bib
bibliographystyle:unsrt

* Appendix                                                           :ignore:
@@latex:\clearpage@@
@@latex:\onecolumn@@
@@latex:\appendix@@

** @@latex:Poincair\'e@@'s conjugate pair
We utilize the following dimensionless coordinate-momentum conjugate
pairs (aka @@latex:Poincair\'e@@ coordinates):
#+begin_src latex
  \begin{align}
    \lambda_i \longleftrightarrow\Lambda_i &= \mu_i\sqrt{\alpha_i} \\
    -\varpi_i \longleftrightarrow\Gamma_i &= \mu_i\sqrt{\alpha_i}(1-\sqrt{1-e_i^2}) \approx \frac12\mu_i\sqrt{\alpha_i}e_i^2,
  \end{align}
#+end_src
@@latex:\noindent@@
where $\varpi_i$ is the longitude of perihelion and $\lambda_i$ the mean longitude
of orbiter $m_i$.

** Geometric energy and AM
In the following, we characterize dissipation by its effects on each
planets' angular momentum (AM) and energy.  A planet's energy,
$\mathcal E$, is determined by its semimajor axis (sma), $a$:
#+begin_src latex
  \begin{align}
     \mathcal E = -\frac{1}{2a},
  \end{align}
  \noindent
#+end_src
@@latex:\noindent@@
where we have chosen units such that $GM=1$.
Angular momentum is given by
#+begin_src latex
  \begin{align}
  h = \mathcal E \sqrt{1-e^2}.
  \end{align}
#+end_src
*** Dissipative effects
The dissipative effects are modeled
by two constant timescales for each planet, 
#+begin_src latex
  \begin{align}
    \frac{\dot a_i}{a_i} = -\frac{1}{2\pi\tau_{ai}} - \frac{pe_i^2}{2\pi\tau_{ei}} \\
    \frac{\dot e_i}{e_i} = -\frac{1}{2\pi\tau_{ei}} ,
  \end{align}
#+end_src
where $\tau_{ai}$ is the exponential e-damping of sma in years.  The
quantity $\tau_{ei}$ is the same for eccentricity.

** Effects of quadrupole potential
A quadrupole potential may arise as a result of secular perturbations
from nearby planets on circular orbits or a $J_2$ moment in the
primary's gravitational field. Due to the difference in sma
between any two orbiters, a quadrupole potential induces
differential apsidal precession on the orbiters.

*** Derivation of differential precession rate $\omega_{\rm eff}$
Consider a massive planet on a circular orbit which perturbs an MMR
which lies internal to its orbit.  Let the planet's mass and sma are
given by $\mu_{\rm ext}$ and $a_{\rm ext}$.  For each planet $m_i$ in
the resonance, the interaction Hamiltonian with the external
planet is given by
#+begin_src latex
  \begin{equation}
    H_{i,\rm ext} = -\frac14 \Gamma_i \mu_{\rm ext}
    \left(\frac{a_i}{a_{\rm ext}}\right) b_{3/2}^{(1)}\left(\frac{a_i}{a_{\rm ext}}\right),
  \end{equation}
#+end_src
@@latex:\noindent@@
for $j=1,2$ and we have utilized the approximation $\Gamma_i \approx \frac12 \Lambda_i e_i^2$.

As a result, each planet experiences a precession in its mean longitude $\lambda_i$ and
$\gamma_i\equiv -\varpi_i$. In particular, the $\dot\varpi_i$ precession frequency
is
#+begin_src latex
  \begin{equation}
  \dot\varpi_{i, \rm ext} = \frac14 \mu_{\rm ext} 
      \left(\frac{a_i}{a_{\rm ext}}\right) b_{3/2}^{(1)}\left(\frac{a_i}{a_{\rm ext}}\right),
  \end{equation}
#+end_src

**** Murray and Dermott
- secular perturbations [[file:./images/screenshot-02.png][7.8]]
- coefficients: [[file:./images/screenshot-03.png][7.9-7.12]]
- bar(alpha12) = [(alpha12 if j=1 external pert),  (1 if j=2 internal pert)]

*** Constant $\omega_{\rm eff}$
Set $q=0.5$, inward migration. For simplicity, set $\dot\varpi_{2,\rm
ext} = 0$ and $\dot\varpi_{1,\rm ext}=\dot\varpi_{\rm eff}$ to be an
arbitrary precession frequency on $m_1$.

#+attr_latex: :float :width 0.6\textwidth
#+caption: Here is the unperturbed system, with $\mu_{tot}=1e-3$,
#+caption: $q=0.5, inward migration, and slow dissipative timescales (T_{w,0}=10000 years) compared to
#+caption: those in Apsidal Alignment paper.
[[./projects/omeff/varyOmeff/q0.50/h-0.03-Tw0-1000-mutot-1.0e-03/000-omeff0-0.000e+00-0.000e+00.png]]

#+attr_latex: :float :width 0.6\textwidth
#+caption: Here is a perturbed system, with $\dot\varpi_{1,\rm ext}=\dot\varpi_{\rm eff}\approx 4\times10^{-6}$
#+caption: and  $\dot\varpi_{2,\rm ext}=0$.
[[./projects/omeff/varyOmeff/q0.50/h-0.03-Tw0-1000-mutot-1.0e-03/010-omeff0-3.981e-06-0.000e+00.png]]

**** Results summary in final eccentricity and $\Delta\varpi$
#+attr_latex: :float :width 0.6\textwidth
#+caption: Here we have plotted the final apsidal angle as a function of $\dot\varpi_{1,\rm ext}$
[[./projects/omeff/varyOmeff/final-Dvarpi-states.png]]

#+attr_latex: :float :width 0.6\textwidth
#+caption: Here we have plotted the final eccentricities as a function of $\dot\varpi_{1,\rm ext}$
[[./projects/omeff/varyOmeff/final-ecc-states.png]]

**** Code validation
#+attr_latex: :float :width 0.6\textwidth
#+caption: In the above figure, we have set the total mass to be 1e-7 so
#+caption: that resonant and secular effects are negligible compared
#+caption: to the effects of external precession on $\gamma_1$.
[[./mpa/tests/omEff/test-omEff.png]]


*** Sign of $\omega_{\rm eff}$ and resonance splitting

** Formal constructions 
The *Kepler problem* is a special case of the *2-body problem*.
Its solutions are...

We may characterize dissipation by its action on the ...
$\tau_{mi}(t)$ and $\tau_{ei}(t)$ by the instantaneous derivatives
#+begin_src latex
  \begin{align}
     \frac{\dot e_i}{e_i} &= - \frac{1}{\tau_e(t)} - \xi(t, \mathbf X_i)\frac{1}{\tau_m(t)} \\
     \frac{\dot a_i}{a_i} &= -\frac{1}{\tau_m(t)} - \zeta(t, \mathbf X_i)\frac{1}{\tau_e(t)},
  \end{align}
  \noindent
#+end_src
@@latex:\noindent@@
where the dot notation corresponds to the time derivative of the
orbital elements. The functions $\xi(t)$ and $\zeta(t)$ are the
coupling between the eccentricity damping, $\tau_e(t)$, and the
semimajor axis (sma) damping, $\tau_m(t)$.

** Hamiltonian Mechanics
** "Natural scaling" in the solar system
The following units
#+begin_src latex
  \begin{align}
  \frac{[GM_\odot][{\rm au}]}{[2\pi{\rm yr}]^2} = 1
  \end{align}
#+end_src
@@latex:\noindent@@ so that time $\tau(t) \equiv 2\pi t$ is the
dimensionless arc length parameterization of a circular orbit
with sma=1 au and $t$ is measured in years.
** Disturbing function for N body problem
