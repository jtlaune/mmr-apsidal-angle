#+TITLE: Rebound MEGNO calculator

want to extend to an analysis of the j:j+1 MMRs role in trapping a
planet into resonance, what kind of "barrier" is it?

I think MEGNO will be a good learning characteristic

* Adapted from: [[https://rebound.readthedocs.io/en/doctest/ipython/Megno.html][rebound docs]]
#+BEGIN_SRC jupyter-python :session /jpy:localhost#8888:research
  import importlib
  importlib.reload(mpa)
#+END_SRC

#+BEGIN_SRC jupyter-python :session /jpy:localhost#8888:research
  import sys
  import os

  sys.path.append("/home/jtlaune/multi-planet-architecture/")
  import mpa
  from mpa import mpl_styles
  import rebound
  import numpy as np
  import matplotlib as mpl
  import matplotlib.pyplot as plt
  %matplotlib inline
#+END_SRC

#+RESULTS:

#+BEGIN_SRC jupyter-python :session /jpy:localhost#8888:research
  # @mpl.rc_context(analytic)
  def simulation(par):
      a, e = par # unpack parameters
      mup = 1e-2
      sim = rebound.Simulation()
      sim.integrator = "whfast"
      sim.ri_whfast.safe_mode = 0
      sim.dt = 5.
      sim.add(m=1.) # Star
      sim.add(m=mup, a=1., l=0., omega=0.0, e=0.03)
      sim.move_to_com()

      sim.init_megno()
      sim.exit_max_distance = 20.
      try:
          sim.integrate(5e2*2.*np.pi, exact_finish_time=0) # integrate for 500 years, integrating to the nearest
          #timestep for each output to keep the timestep constant and preserve WHFast's symplectic nature
          megno = sim.calculate_megno()
          return megno
      except rebound.Escape:
          return 10. # At least one particle got ejected, returning large MEGNO.

  simulation((7,0.1))
#+END_SRC

#+RESULTS:
: 2.021391160012995

#+BEGIN_SRC jupyter-python :session /jpy:localhost#8888:research
  Ngrid = 80
  par_a = np.linspace(1., 2.,Ngrid)
  par_e = np.linspace(0.,0.1,Ngrid)
  parameters = []
  for e in par_e:
      for a in par_a:
          parameters.append((a,e))
  from rebound.interruptible_pool import InterruptiblePool
  pool = InterruptiblePool()
  results = pool.map(simulation,parameters)
#+END_SRC

#+RESULTS:

#+BEGIN_SRC jupyter-python :session /jpy:localhost#8888:research
  @mpl.rc_context(mpl_styles.analytic)
  def plot():
      results2d = np.array(results).reshape(Ngrid, Ngrid)
      fig = plt.figure(figsize=(7, 5))
      ax = plt.subplot(111)
      extent = [min(par_a), max(par_a), min(par_e), max(par_e)]
      ax.set_xlim(extent[0], extent[1])
      ax.set_xlabel("semi-major axis $a$")
      ax.set_ylim(extent[2], extent[3])
      ax.set_ylabel("eccentricity $e$")
      im = ax.imshow(
          results2d,
          interpolation="none",
          vmin=1.9,
          vmax=4,
          cmap="RdYlGn_r",
          origin="lower",
          aspect="auto",
          extent=extent,
      )
      cb = plt.colorbar(im, ax=ax)
      cb.set_label("MEGNO $\\langle Y \\rangle$")
  
  plot()
#+END_SRC

#+RESULTS:
:RESULTS:
#+attr_org: :width 536
[[file:./.ob-jupyter/12ee8dd050706aa038c9b914b0813a6adea6f12a.png]]
:END:
