#+TITLE: MMR Summary
#+AUTHOR: JT Laune
#+DATE: <2022-02-08 Tue>
#+LATEX_CLASS: article
#+OPTIONS: toc:nil
#+LATEX_HEADER: \usepackage{amsthm}
#+LATEX_HEADER: \newtheorem{defn}{Definition}
#+STARTUP: nolatexpreview

* Start                                                            :noexport:
Consider $n$ point *orbiters* with finite masses
$m_1,m_2,m_3,\ldots\ll M$, where $M$ is the mass of the primary about
which they orbit. Most generally, its Hamiltonian is:
#+begin_src latex
  \begin{align}
    \mathcal H
    &\simeq \sum^{n}_{i=1}\left(\frac12 \frac{\vec p_i\cdot\vec p_i}{m_i}
      -\frac{GMm_i}{2|\vec x_i|}
      -\sum_{j\neq i}^{n} \frac{Gm_im_j}{2|\vec x_i - \vec x_j|}
      \right), \\
  \end{align}
#+end_src
where $\vec x_i$ and $\vec p_i$ are the Cartesian position and momentum vectors, respectively.

* Assumptions and notation
- Two comparable mass orbiters, $i=1,2$
  - Internal/external duality around q=1
- Coplanar, $i_i=0$
- Eccentricities are small, $e_i\ll 1$
  - First order expansion in $e_i$
- Orbiter masses are small, $m_i\ll M$
- Near a first order MMR (1MMR), $j = 1, 2, \ldots$
- separable $\dot\varpi_{1,\rm ext}$ and $\dot\varpi_{2,\rm ext}$
** Definitions                                                    :noexport:
#+attr_latex: :options [Runge-Lenz vector]
#+begin_defn
the Cartesian vector with magnitude @@latex:$e$@@ in the
direction of orbital perihelion
#+end_defn

* Scaling
We choose the following units
#+begin_src latex
  \begin{align}
  \frac{[GM_\odot][{\rm au}]}{4\pi^2[{\rm yr}]^2} = 1
  \end{align}
#+end_src
@@latex:\noindent@@ so that time $\tau(t) \equiv 2\pi t$ is the
dimensionless arc length parameterization of a circular orbit and $t$ is measured in years.

The dimensionless Hamiltonian is then
#+begin_src latex
  \begin{align}
    \hat{\mathcal H}
    &\simeq \sum^{n}_{i=1}\left(\frac12 \hat p_i\cdot\hat p_i
      -\frac{G\mu_i}{2|\hat x_i|} \right)
      - \sum_{j\neq i}^{n} \left(\frac{G\mu_i\mu_j}{2|\hat x_i - \hat x_j|}
      \right),\\
    &\equiv H_0 + H_1
  \end{align}
#+end_src
@@latex:\noindent@@ where $\hat x_i$ and $\hat p_i$ are the
dimensionless Cartesian coordinates and momenta.  The first sum $H_0$ is
known as the Keplerian Hamiltonian and is $\mathcal O(\mu_i)$; the second is the
$\mathcal O(\mu_i\mu_j)$ contribution from mutual interactions, $H_{1}$.

* Dimensionless parameters
We define:
#+begin_src latex
  \begin{align}
   q&\equiv \frac{m_1}{m_2}\quad\text{mass ratio with each other}\\ 
   \mu_i&\equiv \frac{m_i}{M}\quad\text{dimless mass}\\ 
   \mu_{\rm tot}&\equiv \mu_1+\mu_2\quad\text{total mass},\\ 
   %\mu_{\rm ext}&\equiv \frac{m_{\rm ext}}{M}\quad\text{total mass},\\ 
  \end{align}
#+end_src
@@latex:\noindent@@
where $M$ is the primary mass.

* Geometric energy and AM
In the following, we characterize dissipation by its effects on each
planets' angular momentum (AM) and energy.  A planet's energy,
$\mathcal E$, is determined by its semimajor axis (sma), $a$:
#+begin_src latex
  \begin{align}
     \mathcal E = -\frac{1}{2a},
  \end{align}
  \noindent
#+end_src
@@latex:\noindent@@
where we have chosen units such that $GM=1$.
Angular momentum is given by
#+begin_src latex
  \begin{align}
  h = \mathcal E \sqrt{1-e^2}.
  \end{align}
#+end_src
** Dissipative effects
The dissipative effects are modeled
by two constant timescales for each planet, 
#+begin_src latex
  \begin{align}
    \frac{\dot a_i}{a_i} = -\frac{1}{2\pi\tau_{ai}} - \frac{pe_i^2}{2\pi\tau_{ei}} \\
    \frac{\dot e_i}{e_i} = -\frac{1}{2\pi\tau_{ei}} ,
  \end{align}
#+end_src
where $\tau_{ai}$ is the exponential e-damping of sma in years.  The
quantity $\tau_{ei} is the same for eccentricity.

* @@latex:Poincair\'e@@'s conjugate pair
We utilize the following dimensionless coordinate-momentum conjugate
pairs (aka @@latex:Poincair\'e@@ coordinates):
#+begin_src latex
  \begin{align}
    \lambda_i \longleftrightarrow\Lambda_i &= \mu_i\sqrt{\alpha_i} \\
    -\varpi_i \longleftrightarrow\Gamma_i &= \mu_i\sqrt{\alpha_i}(1-\sqrt{1-e_i^2}) \approx \frac12\mu_i\sqrt{\alpha_i}e_i^2,
  \end{align}
#+end_src
@@latex:\noindent@@
where $\varpi_i$ is the longitude of perihelion and $\lambda_i$ the mean longitude
of orbiter $m_i$.

* MMR Hamiltonian Model
Index MMR locations with $j$, such that first order MMRs (hereafter ``1MMRS'') occur whenever
$n_1/n_2\simeq(j+1)/j$.
Near these points, the relative angle between these 

Near this point, the following geometric angles in the literal expansion of the perturbing
function (see [[cite:&murray_solar_2000][Murray and Dermott]] for details) have commensurate ``fast'' frequencies
#+begin_src latex
  \begin{align}
  \theta_1 &= (j+1)\lambda_2-j\lambda_1-\varpi_1\\
  \theta_2 &= (j+1)\lambda_2-j\lambda_1-\varpi_2
  \end{align}
#+end_src


We may use the @@latex:Poincair\'e@@ elements to write
the dimensionless Hamiltonian as:
#+begin_src latex
  \begin{align}
  \label{eq:H_1}
    \mathcal{H}
    = -\frac{q^3}{2(1+q)^3 \Lambda_1^2}
      - \frac{1}{2(1+q)^3\Lambda_2^2}
     - \frac{\tilde\mu}{(1+q)^2 \Lambda_2^2}\left[
      f_1\sqrt{\frac{2\Gamma_1}{\Lambda_1}}\cos\theta_1
      +f_2\sqrt{\frac{2\Gamma_2}{\Lambda_2}}\cos\theta_2
      \right],
  \end{align}
#+END_SRC
@@latex:\noindent@@ where we have defined
$\tilde\mu=\mu_1\mu_2/(\mu_1+\mu_2)$ to be the reduced mass ratio.
and the $\theta_i$ are conjugate to $\Gamma_i$.  For the limiting
cases of $q\to \infty$ ($m_2=0$) or $q\to 0$ ($m_1=0$), the ratio
$\mathcal{H}/\Lambda_i$ reduces to the standard test particle
Hamiltonian found in [[cite:&murray_solar_2000][Murray and Dermott]] if the limits are taken
carefully.

* External companion
** Constant $\omega_{\rm eff}$
Set $q=0.5$, inward migration. For simplicity, set $\dot\varpi_{2,\rm
ext} = 0$ and $\dot\varpi_{1,\rm ext}=\dot\varpi_{\rm eff}$ to be an
arbitrary precession frequency on $m_1$.

#+attr_latex: :float :width 0.6\textwidth
#+caption: Here is the unperturbed system, with $\mu_{tot}=1e-3$,
#+caption: $q=0.5, inward migration, and slow dissipative timescales (T_{w,0}=10000 years) compared to
#+caption: those in Apsidal Alignment paper.
[[./projects/omeff/varyOmeff/q0.50/h-0.03-Tw0-1000-mutot-1.0e-03/000-omeff0-0.000e+00-0.000e+00.png]]

#+attr_latex: :float :width 0.6\textwidth
#+caption: Here is a perturbed system, with $\dot\varpi_{1,\rm ext}=\dot\varpi_{\rm eff}\approx 4\times10^{-6}$
#+caption: and  $\dot\varpi_{2,\rm ext}=0$.
[[./projects/omeff/varyOmeff/q0.50/h-0.03-Tw0-1000-mutot-1.0e-03/010-omeff0-3.981e-06-0.000e+00.png]]

*** Results summary in final eccentricity and $\Delta\varpi$
#+attr_latex: :float :width 0.6\textwidth
#+caption: Here we have plotted the final apsidal angle as a function of $\dot\varpi_{1,\rm ext}$
[[./projects/omeff/varyOmeff/final-Dvarpi-states.png]]

#+attr_latex: :float :width 0.6\textwidth
#+caption: Here we have plotted the final eccentricities as a function of $\dot\varpi_{1,\rm ext}$
[[./projects/omeff/varyOmeff/final-ecc-states.png]]

*** Code validation
#+attr_latex: :float :width 0.6\textwidth
#+caption: In the above figure, we have set the total mass to be 1e-7 so
#+caption: that resonant and secular effects are negligible compared
#+caption: to the effects of external precession on $\gamma_1$.
[[./mpa/tests/omEff/test-omEff.png]]


** Secular @@latex:$\varpi$@@-precession rates
Consider a massive planet on a circular orbit which perturbs an MMR
which lies internal to its orbit.  Let the planet's mass and sma are
given by $\mu_{\rm ext}$ and $a_{\rm ext}$.  For each planet $m_i$ in
the resonance, the interaction Hamiltonian with the external
planet is given by
#+begin_src latex
  \begin{equation}
    H_{i,\rm ext} = -\frac14 \frac{\Gamma_i}{\Lambda_i} \mu_{\rm ext}
    \left(\frac{a_i}{a_{\rm ext}}\right) b_{3/2}^{(1)}\left(\frac{a_i}{a_{\rm ext}}\right),
  \end{equation}
#+end_src
@@latex:\noindent@@
for $j=1,2$ and we have utilized the approximation $\Gamma_i \approx \frac12 \Lambda_i e_i^2$.

As a result, each planet experiences a precession in its mean longitude $\lambda_i$ and
$\gamma_i\equiv -\varpi_i$. In particular, the $\dot\varpi_i$ precession frequency
is
#+begin_src latex
  \begin{equation}
  \dot\varpi_{i, \rm ext} = \frac14 \frac{1}{\Lambda_j} \mu_{\rm ext} 
      \left(\frac{a_i}{a_{\rm ext}}\right) b_{3/2}^{(1)}\left(\frac{a_i}{a_{\rm ext}}\right),
  \end{equation}
#+end_src

** Sign of $\omega_{\rm eff}$
One can show
#+begin_src latex
  \begin{equation}
    \dot\varpi_{1,\rm ext}-\dot\varpi_{2,\rm ext}
  \propto \left(\frac{f_3(a_2/a_{\rm ext})}{f_3(a_1/a_{\rm ext})} - q\right)
  \end{equation}
#+end_src
where $f_3$ is a combination of Laplace coefficients and their derivatives.
#+attr_latex: :float
#+caption: Here we have plotted @@latex:$f_3(a_2/a_{\rm ext})/f_3(a_1/a_{\rm ext})$@@.
#+caption: The horizontal lines show $\alpha$ values where MMRs occur.
[[./images/maxq-aext-5.0.png]]


* Formal constructions                                             :noexport:
The *Kepler problem* is a special case of the *2-body problem*.
Its solutions are...

We may characterize dissipation by its action on the ...
$\tau_{mi}(t)$ and $\tau_{ei}(t)$ by the instantaneous derivatives
#+begin_src latex
  \begin{align}
     \frac{\dot e_i}{e_i} &= - \frac{1}{\tau_e(t)} - \xi(t, \mathbf X_i)\frac{1}{\tau_m(t)} \\
     \frac{\dot a_i}{a_i} &= -\frac{1}{\tau_m(t)} - \zeta(t, \mathbf X_i)\frac{1}{\tau_e(t)},
  \end{align}
  \noindent
#+end_src
@@latex:\noindent@@
where the dot notation corresponds to the time derivative of the
orbital elements. The functions $\xi(t)$ and $\zeta(t)$ are the
coupling between the eccentricity damping, $\tau_e(t)$, and the
semimajor axis (sma) damping, $\tau_m(t)$.

* Hamiltonian Mechanics                                            :noexport:
* References
bibliography:references.bib
bibliographystyle:unsrt
* code                                                             :noexport:
#+BEGIN_SRC jupyter-python :session /jpy:localhost#8888:research
  import os

  os.chdir("/home/jtlaune/multi-planet-architecture/")
  import mpa.fndefs as fns
  from mpa import mpl_styles
  import numpy as np
  import matplotlib as mpl
  import matplotlib.pyplot as plt
  from matplotlib import colors


  @mpl.rc_context(mpl_styles.analytic)
  def plot_func(alpha_1, alpha_2, ratio):
      return plt.contourf(
          alpha_1,
          alpha_2,
          ratio,
      )


  # scalars
  j = 2
  a1 = 1
  Npts = 100
  alpha = (j / (j + 1)) ** (2.0 / 3)
  alpha_ext = 5.0 * a1

  # vectors
  alpha_1 = a1 * np.linspace(0.5, 2, Npts)
  alpha =  np.linspace(1/1.7, 1., Npts)
  a1coord, alphacoord = np.meshgrid(alpha_1, alpha)  # units au
  a2coord = a1coord/alphacoord
  ratio = fns.sqr_ei_lc(a2coord / alpha_ext) / fns.sqr_ei_lc(a1coord / alpha_ext)
  cs = plot_func(a1coord, a2coord / a1coord, ratio)
  cb = plt.colorbar(cs, label=r"max $q$ before sign flip")
  #plt.text(1.4,4,r"$\frac{f_3(a_2/a_{\rm ext})}{f_3(a_1/a_{\rm ext})}$", fontsize=24)
  plt.xlabel(r"$a_1$")
  plt.ylabel(r"$\alpha$")
  plt.title(r"$a_{\rm ext}=$" + f"{alpha_ext}")
  for j in range(1, 8):
      plt.axhline(y=((j + 1) / j) ** (2.0 / 3.0), c="k", ls="--", lw="1")
  plt.savefig(f"images/maxq-aext-{alpha_ext}.png")
#+END_SRC

#+RESULTS:
[[file:./.ob-jupyter/b5eefa66e6c4f1ad9f4c9c42696f622b80cc6363.png]]
